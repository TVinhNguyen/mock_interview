version: '3.8'

services:
  # API Gateway - Port 8000
  api-gateway:
    build:
      context: ./apps/api-gateway
      dockerfile: Dockerfile
    container_name: interview-api-gateway
    ports:
      - "8000:8000"
    environment:
      - STT_SERVICE_URL=http://stt-service:8001
      - LLM_SERVICE_URL=http://llm-service:8002
      - TTS_SERVICE_URL=http://tts-service:8003
    depends_on:
      - stt-service
      - llm-service
      - tts-service
    networks:
      - interview-network
    restart: unless-stopped

  # STT Service (Speech-to-Text) - Port 8001
  stt-service:
    build:
      context: ./apps/stt-service
      dockerfile: Dockerfile
    container_name: interview-stt-service
    ports:
      - "8001:8001"
    environment:
      - GROQ_API_KEY=${GROQ_API_KEY}
    networks:
      - interview-network
    restart: unless-stopped

  # LLM Service (AI Interviewer) - Port 8002
  llm-service:
    build:
      context: ./apps/llm-service
      dockerfile: Dockerfile
    container_name: interview-llm-service
    ports:
      - "8002:8002"
    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
    networks:
      - interview-network
    restart: unless-stopped

  # TTS Service (Text-to-Speech) - Port 8003
  tts-service:
    build:
      context: ./apps/tts-service
      dockerfile: Dockerfile
    container_name: interview-tts-service
    ports:
      - "8003:8003"
    volumes:
      - tts-audio:/app/temp_audio
    networks:
      - interview-network
    restart: unless-stopped

  # Frontend (Next.js) - Port 3000
  frontend:
    build:
      context: .
      dockerfile: ./apps/frontend/Dockerfile
    container_name: interview-frontend
    ports:
      - "3000:3000"
    environment:
      - NEXT_PUBLIC_GATEWAY_URL=http://localhost:8000
    volumes:
      - ./apps/frontend/src:/app/apps/frontend/src
    depends_on:
      - api-gateway
    networks:
      - interview-network
    restart: unless-stopped

networks:
  interview-network:
    driver: bridge

volumes:
  tts-audio:
